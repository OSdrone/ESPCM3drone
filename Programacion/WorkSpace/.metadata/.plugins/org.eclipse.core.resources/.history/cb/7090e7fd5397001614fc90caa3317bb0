/*
 * FuncionAHRS.c
 *
 *  Created on: 13 de oct. de 2016
 *      Author: DTUser
 */

#include "Funciones_RTOS.h"
#include "../AHRS.h"
#include "../ServidoresVariables.h"

void AHRS_TASK_FCN(void const * argument) {

	static tpAHRS AHRS;
	static tpLecturas9DOFIMU Lecturas9DOFIMU;

	//TODO Configurar AHRS

	while (1) {
		xSemaphoreTake(AHRS_SMPHRHandle, portMAX_DELAY);

		//AHRS.SensibilidadGiroscopo =
		LeerLecturasIMU9DOF(&Lecturas9DOFIMU);

		//Cargamos datos
/*
		AHRS.Vector_Aceleracion_lineal[0] = Lecturas9DOFIMU.Valor.x_acel;
		AHRS.Vector_Aceleracion_lineal[1] = Lecturas9DOFIMU.Valor.y_acel;
		AHRS.Vector_Aceleracion_lineal[2] = Lecturas9DOFIMU.Valor.z_acel;

		AHRS.Vector_Velocidad_Angular[0] = Lecturas9DOFIMU.Valor.x_vel;
		AHRS.Vector_Velocidad_Angular[1] = Lecturas9DOFIMU.Valor.y_vel;
		AHRS.Vector_Velocidad_Angular[2] = Lecturas9DOFIMU.Valor.z_vel;

		AHRS.Vector_Magnetico[0] = Lecturas9DOFIMU.Valor.x_mag;
		AHRS.Vector_Magnetico[1] = Lecturas9DOFIMU.Valor.y_mag;
		AHRS.Vector_Magnetico[2] = Lecturas9DOFIMU.Valor.z_mag;
*/
		//Ejecutamos Algoritmo

		//Almacenamos resultados
		EscribirVariableAHRS(&AHRS);
	}
}

void AHRS_TIMER_FCN(void const * argument) {
	xSemaphoreGive(AHRS_SMPHRHandle);
}
